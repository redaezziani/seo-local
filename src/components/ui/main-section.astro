---
import UsersAvatar from './users-avatar.astro';
import { sanityClient } from 'sanity:client';
import imageUrlBuilder from '@sanity/image-url';
import { getCurrentLanguage, getLocalizedText } from '@/utils/language';

const heroData = await sanityClient.fetch(
  `*[_type == "heroSection" && isActive == true][0]`,
);

// Get current language from URL
const currentLang = getCurrentLanguage(Astro.url);

const builder = imageUrlBuilder(sanityClient);
const urlFor = (source: any) => builder.image(source);
---

<main
  class={`w-full px-4 h-[60vh] lg:min-h-[75vh] flex justify-center items-center ${heroData?.backgroundColor || 'bg-zinc-900'} relative`}
>
  <span
    class="absolute z-10 top-0 left-0 w-full h-[30rem] bg-gradient-to-b from-zinc-950 to-transparent"
  >
  </span>
  <div
    class={`grid w-96 lg:w-[35rem] z-1 gap-x-6 right-6 top-30 grid-cols-2 absolute h-full ${heroData?.backgroundImages?.applyGrayscale ? 'grayscale-100' : ''}`}
  >
    <div class="flex gap-6 flex-col">
      {
        heroData?.backgroundImages?.leftColumn?.map((image: any) => (
          <img
            src={urlFor(image.asset).url()}
            alt={image.alt || 'Hero Image'}
            class="object-cover w-full rounded-md"
          />
        ))
      }
    </div>
    <div class="flex gap-6 -mt-4 flex-col">
      {
        heroData?.backgroundImages?.rightColumn?.map((image: any) => (
          <img
            src={urlFor(image.asset).url()}
            alt={image.alt || 'Hero Image'}
            class="object-cover w-full rounded-md"
          />
        ))
      }
    </div>
  </div>
  <span
    class="absolute md:hidden z-5 bg-gradient-to-b from-zinc-950 via-zinc-900 to-transparent h-full w-full"
  >
  </span>
  <section
    class={`flex w-full  mt-4 ${heroData?.textColor || 'text-gray-50'} lg:max-w-[100rem] flex-col gap-2 relative z-20`}
  >
    <h1
      class="text-2xl md:text-5xl max-w-4xl font-bold leading-tight [&>span.highlight]:text-blue-500"
      set:html={getLocalizedText(heroData?.heading, currentLang)}
    />
    <p class="text-gray-300 text-sm md:text-base max-w-xl mt-2">
      {getLocalizedText(heroData?.subheading, currentLang)}
    </p>
    {
      heroData?.socialProof?.showRating && (
        <div class="mt-4 gap-x-4 flex gap-y-2 flex-wrap items-center">
          <UsersAvatar />
          <div class="flex gap-1 items-end">
            {Array.from({
              length: heroData?.socialProof?.ratingValue || 5,
            }).map(() => (
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="fill-amber-300 size-5"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M8.243 7.34l-6.38 .925l-.113 .023a1 1 0 0 0 -.44 1.684l4.622 4.499l-1.09 6.355l-.013 .11a1 1 0 0 0 1.464 .944l5.706 -3l5.693 3l.1 .046a1 1 0 0 0 1.352 -1.1l-1.091 -6.355l4.624 -4.5l.078 -.085a1 1 0 0 0 -.633 -1.62l-6.38 -.926l-2.852 -5.78a1 1 0 0 0 -1.794 0l-2.853 5.78z" />
              </svg>
            ))}
            <span class="text-xs text-gray-200">
              {getLocalizedText(heroData?.socialProof?.ratingText, currentLang)}
            </span>
          </div>
        </div>
      )
    }
    <div class="mt-5 md:mt-10 gap-x-4 flex flex-wrap items-center">
      <span class="flex group">
        <button
          class="rounded-lg bg-blue-500 text-white text-sm px-6 group-hover::bg-blue-500 transition py-2.5"
        >
          {getLocalizedText(heroData?.primaryCta?.text, currentLang)}
        </button>
        {
          heroData?.primaryCta?.showIcon && (
            <span class="rounded-lg bg-blue-500 flex justify-center items-center text-white group-hover::bg-blue-500 transition font-semibold text-sm size-10 py-2.5">
              <svg
                class="rotate-220"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 5v.5m0 3v1.5m0 3v6" />
                <path d="M18 13l-6 6" />
                <path d="M6 13l6 6" />
              </svg>
            </span>
          )
        }
      </span>

      <span class="flex">
        <button
          class="rounded-lg bg-zinc-600 text-white text-sm px-5 py-2.5 hover:bg-zinc-700 transition"
        >
          {getLocalizedText(heroData?.secondaryCta?.text, currentLang)}
        </button>

        {
          heroData?.secondaryCta?.showIcon && (
            <span class="rounded-lg bg-zinc-600 flex justify-center items-center text-white/70 font-semibold text-sm w-10 h-10 hover:bg-zinc-700 transition">
              <svg
                class="rotate-220 w-5 h-5"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" />
                <path d="M12 5v.5m0 3v1.5m0 3v6" />
                <path d="M18 13l-6 6" />
                <path d="M6 13l6 6" />
              </svg>
            </span>
          )
        }
      </span>
    </div>
  </section>
</main>
